<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <script src="https://www.gstatic.com/firebasejs/9.13.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.13.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/ui/6.0.2/firebase-ui-auth.js"></script>
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
  <link type="text/css" rel="stylesheet" href="https://www.gstatic.com/firebasejs/ui/6.0.2/firebase-ui-auth.css" />
  <script type="text/javascript">
    const firebaseConfig = {
      apiKey: "AIzaSyDyr4yG7khoWYsteBcYqVy-t00YlCevtkY",
      projectId: "core-learning-services-dev",
      authDomain: "core-learning-services-dev.firebaseapp.com"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    // FirebaseUI config.
    let uiConfig = {
      signInOptions: [
        {
          provider: firebase.auth.GoogleAuthProvider.PROVIDER_ID,
          customParameters: {
            // Forces account selection even when one account is available.
            prompt: "select_account"
          }
        }
      ],
      callbacks: {
        signInSuccessWithAuthResult: function (authResult, redirectUrl) {
          let user = authResult.user;
          let token = user._delegate.accessToken
          document.getElementById("waiting-text").style.display = "block"
          document.getElementById("waiting-text").innerText = "Redirecting..."
          axios
            .get('{{redirect_url}}', {
              headers: {
                Authorization: `Bearer ${token}`,
              },
            })
            .then((response) => {
              response.data
                ? response.data.url
                  ? window.open(response.data.url, "_self").focus()
                  : console.log("No URL found in the response")
                : console.log("No response data");
            })
          return false;
        },
      },
    };

    // Initialize the FirebaseUI Widget using Firebase.
    let ui = new firebaseui.auth.AuthUI(firebase.auth());
    // The start method will wait until the DOM is loaded.
    ui.start('#firebaseui-auth-container', uiConfig);

    function getParameterByName(name, url = window.location.href) {
      name = name.replace(/[\[\]]/g, '\\$&');
      var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
        results = regex.exec(url);
      if (!results) return null;
      if (!results[2]) return '';
      return decodeURIComponent(results[2].replace(/\+/g, ' '));
    }
  </script>
</head>

<body>
  <h1 style="text-align: center; margin-bottom: 3rem">
    You are required to sign in before we proceed further
    <h3 id="waiting-text" style="text-align: center; display: none;"></h3>
  </h1>

  <div id="firebaseui-auth-container"></div>
</body>

</html>